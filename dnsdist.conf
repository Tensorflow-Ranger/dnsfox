-- Use curly braces to define the list (table)
setACL({ "0.0.0.0/0", "::/0" })

-- 2. LISTENERS (Where people connect)
addLocal('0.0.0.0:53')      -- Standard UDP/TCP DNS
addLocal('[::]:53')         -- Standard IPv6 DNS

addDOHLocal(
  "0.0.0.0:443",
  "/etc/dnsdist/certs/fullchain.pem",
  "/etc/dnsdist/certs/privkey.pem",
  "/dns-query",
  { reusePort=true }
)

-- 3. BACKENDS (Your Unbound "brain")
-- We point to Unbound on the IPv6 loopback
newServer({
  address="127.0.0.1:5335",
  name="unbound-backend",
  checkName="google.com.",  -- Health check
  mustResolve=true
})

-- 4. RATE LIMITING (Stop bots)
-- Limit each IP to 10 queries per second; drop extras
local dbr = MaxQPSIPRule(10)
addAction(dbr, DropAction())

-- 5. WEB INTERFACE (For monitoring)
-- View at http://YOUR_AWS_IP:8083 (You'll need an SSH tunnel or open port)
webserver("127.0.0.1:8083")
setWebserverConfig({password="change_me_securely", apiKey="another_secure_key"})